<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:TAAS.NetMAUI.Presentation"  
             x:Class="TAAS.NetMAUI.Presentation.MainPage"
             xmlns:vm="clr-namespace:TAAS.NetMAUI.Presentation.ViewModels"    
             xmlns:converters="clr-namespace:TAAS.NetMAUI.Presentation.Converters">

    <Shell.TitleView>
        <local:ShellTitleView ViewTitle="Audit Assignments" />
    </Shell.TitleView>

    <!-- RESOURCES -->
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:AuditNameToStringConverter x:Key="AuditNameToStringConverter" />
            <converters:CoordinatorAuditorToStringConverter x:Key="CoordinatorAuditorToStringConverter" />
            <converters:AuditAssignmentAuditorsToStringConverter x:Key="AuditAssignmentAuditorsToStringConverter" />
            <converters:AuditAssignmentTemporaryAuditorsToStringConverter x:Key="AuditAssignmentTemporaryAuditorsToStringConverter" />
            <converters:AuditAssignmentOperationAuditTypesToStringConverter x:Key="AuditAssignmentOperationAuditTypesToStringConverter" />
            <converters:AuditAssignmentFinancialAuditTypesToStringConverter x:Key="AuditAssignmentFinancialAuditTypesToStringConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <!-- ROOT GRID (NO SCROLLVIEW) -->
    <Grid RowDefinitions="Auto,*" Padding="10">

        <!-- INFO TEXT -->
        <VerticalStackLayout Grid.Row="0" Spacing="15">
            <Label HorizontalOptions="Start">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="The audit assignments you previously retrieved from the web service are listed below. Click " />

                        <Span Text="here"
                              TextDecorations="Underline"
                              TextColor="{StaticResource HmbHyperlink}">
                            <Span.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding PullDataCommand}" />
                            </Span.GestureRecognizers>
                        </Span>

                        <Span Text=" to pull new data" />
                    </FormattedString>
                </Label.FormattedText>
            </Label>
        </VerticalStackLayout>

        <!-- COLLECTIONVIEW WITH BORDER (UNCHANGED LOOK) -->
        <Border Grid.Row="1">

            <CollectionView ItemsSource="{Binding AuditAssignments}">

                <CollectionView.EmptyView>
                    <Label Text="No data to display" />
                </CollectionView.EmptyView>

                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="3"
                                     VerticalItemSpacing="10"
                                     HorizontalItemSpacing="10"/>
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border>
                            <VerticalStackLayout Padding="32">

                                <Label>
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Audit Name: " FontAttributes="Bold" />
                                            <Span Text="{Binding Converter={StaticResource AuditNameToStringConverter}}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label>
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Coordinator: " FontAttributes="Bold" />
                                            <Span Text="{Binding CoordinatorAuditor, Converter={StaticResource CoordinatorAuditorToStringConverter}}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label>
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Auditors: " FontAttributes="Bold" />
                                            <Span Text="{Binding AuditAssignmentAuditors, Converter={StaticResource AuditAssignmentAuditorsToStringConverter}}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label>
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Temporary Auditors: " FontAttributes="Bold" />
                                            <Span Text="{Binding AuditAssignmentTemporaryAuditors, Converter={StaticResource AuditAssignmentTemporaryAuditorsToStringConverter}}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label>
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Operation Audit Types: " FontAttributes="Bold" />
                                            <Span Text="{Binding AuditAssignmentOperationAuditTypes, Converter={StaticResource AuditAssignmentOperationAuditTypesToStringConverter}}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label>
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Financial Audit Types: " FontAttributes="Bold" />
                                            <Span Text="{Binding AuditAssignmentFinancialAuditTypes, Converter={StaticResource AuditAssignmentFinancialAuditTypesToStringConverter}}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <FlexLayout Margin="4" Direction="Row" Wrap="Wrap" JustifyContent="Start" AlignItems="Center" >
                                    <Button Text="System Audits"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=ShowSystemAuditChecklistsCommand}"
                                            CommandParameter="{Binding .}"
                                            Style="{StaticResource BorderButtonStyle}" 
                                            Margin="0,0,1,1"/> <!-- left,top,right,bottom -->

                                    <Button Text="Operation Audits"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=ShowOperationAuditChecklistsCommand}"
                                            CommandParameter="{Binding .}"
                                            Style="{StaticResource BorderButtonStyle}"
                                            Margin="0,0,1,1"/>

                                    <Button Text="Financial Audits"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainPageViewModel}}, Path=ShowFinancialAuditChecklistsCommand}"
                                            CommandParameter="{Binding .}"
                                            Style="{StaticResource BorderButtonStyle}"
                                            Margin="0,0,0,1"/>
                                </FlexLayout>

                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>

        </Border>

    </Grid>
</ContentPage>
